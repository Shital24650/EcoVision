<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>EcoSnap ‚Äî Waste Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>.glass{background:rgba(255,255,255,0.04);backdrop-filter:blur(6px)} .card{box-shadow:0 8px 30px rgba(2,6,23,0.4)}</style>
</head>
<body class="bg-gradient-to-br from-emerald-700 via-slate-900 to-emerald-800 text-slate-100 min-h-screen">
  <nav class="bg-slate-900/30 glass sticky top-0 z-50">
    <div class="max-w-6xl mx-auto flex items-center justify-between p-4">
      <div class="flex items-center gap-3"><div class="text-2xl">üåø</div><a href="index.html" class="font-bold text-lg">EcoSnap</a></div>
      <div class="flex gap-3">
        <a href="index.html" class="px-3 py-2 rounded hover:bg-white/5">Detect</a>
        <a href="carbon.html" class="px-3 py-2 rounded hover:bg-white/5">Carbon Calc</a>
        <a href="waste.html" class="px-3 py-2 rounded hover:bg-white/5">Tracker</a>
      </div>
    </div>
  </nav>

  <main class="max-w-4xl mx-auto p-6">
    <section class="card glass rounded-xl p-6" data-aos="fade-up">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl font-extrabold">Waste Tracker</h1>
        <button id="addSample" class="px-3 py-2 bg-emerald-500 rounded">Add Sample Data</button>
      </div>

      <form id="wasteForm" class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <select id="wasteType" class="p-2 rounded bg-white/5">
          <option value="Plastic">Plastic</option>
          <option value="Paper">Paper</option>
          <option value="Glass">Glass</option>
          <option value="Metal">Metal</option>
          <option value="Organic">Organic</option>
          <option value="E-waste">E-waste</option>
          <option value="Other">Other</option>
        </select>
        <input id="wasteQty" type="number" min="0" placeholder="Qty (items or kg)" class="p-2 rounded bg-white/5"/>
        <button class="col-span-1 md:col-span-1 px-4 py-2 bg-emerald-500 rounded">Add</button>
      </form>

      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-semibold">History</h3>
          <div id="history" class="mt-3 max-h-64 overflow-auto p-2 bg-white/5 rounded"></div>
        </div>
        <div>
          <h3 class="font-semibold">Insights</h3>
          <div id="insights" class="mt-3 p-2 bg-white/5 rounded min-h-[120px]"></div>
        </div>
      </div>

      <div class="mt-6">
        <canvas id="pieChart" style="max-height:300px"></canvas>
      </div>

      <div class="mt-4 flex gap-2">
        <button id="exportBtn" class="px-3 py-2 bg-emerald-500 rounded">Export CSV</button>
        <button id="clearBtn" class="px-3 py-2 bg-white/5 rounded">Clear All</button>
      </div>
    </section>
  </main>

  <footer class="max-w-6xl mx-auto p-4 text-center text-sm text-emerald-200/60">Powered by AI ‚Äî Helping you live greener üåç</footer>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init();
    const form = document.getElementById('wasteForm'), wasteType = document.getElementById('wasteType'), wasteQty = document.getElementById('wasteQty'),
          historyEl = document.getElementById('history'), insightsEl = document.getElementById('insights'),
          pieCtx = document.getElementById('pieChart').getContext('2d'), exportBtn = document.getElementById('exportBtn'), clearBtn = document.getElementById('clearBtn'), addSample = document.getElementById('addSample');

    let data = JSON.parse(localStorage.getItem('ecosnap_tracker')||'[]');
    let pie = null;

    function renderHistory() {
      if(!data.length) { historyEl.innerHTML = '<div class="text-emerald-200/70">No entries yet.</div>'; return; }
      historyEl.innerHTML = data.slice().reverse().map((d,i)=>`<div class="p-2 border-b border-white/5"><div class="text-sm text-emerald-200/80">${d.date}</div><div class="font-semibold">${d.type} ‚Äî ${d.qty}</div><div class="text-xs text-emerald-200/70">${d.label||''}</div></div>`).join('');
    }

    function renderChart() {
      const totals = {};
      data.forEach(d => totals[d.type] = (totals[d.type]||0) + Number(d.qty || 0));
      const labels = Object.keys(totals); const values = labels.map(l=>totals[l]);
      if(pie) pie.destroy();
      pie = new Chart(pieCtx, { type:'pie', data:{ labels, datasets:[{ data: values, backgroundColor: ['#34D399','#60A5FA','#FBBF24','#FB7185','#A78BFA','#94A3B8'] }]}, options:{plugins:{legend:{position:'right'}}} });
    }

    function analyze() {
      if(!data.length){ insightsEl.innerHTML = '<div class="text-emerald-200/70">No insights yet ‚Äî add entries.</div>'; return; }
      // simple pattern analysis: percent breakdown + weekly trend guess
      const totals = {}; let sum=0;
      data.forEach(d => { totals[d.type] = (totals[d.type]||0) + Number(d.qty||0); sum += Number(d.qty||0); });
      const sorted = Object.entries(totals).sort((a,b)=>b[1]-a[1]);
      const dominant = sorted[0];
      const percent = ((dominant[1]/sum)*100).toFixed(1);
      // sample suggested actions
      let suggestion = '';
      if(dominant[0] === 'Plastic') suggestion = 'Focus on reusable alternatives (bottles, bags). Try a Plastic-Free Week challenge.';
      else if(dominant[0] === 'Organic') suggestion = 'Start composting to reduce methane and return nutrients to soil.';
      else if(dominant[0] === 'E-waste') suggestion = 'Collect e-waste for proper disposal & buy longer-lasting electronics.';
      else suggestion = 'Reduce single-use items and prefer durable products.';
      // predict next week (very simple extrapolation)
      const weeklyEstimate = (dominant[1]/Math.max(1, new Set(data.map(d=>d.date)).size))*7;
      insightsEl.innerHTML = `<div class="p-2"><strong>Insight:</strong> ${percent}% of your logged waste is <strong>${dominant[0]}</strong>.<div class="mt-2">${suggestion}</div><div class="mt-2 text-sm text-emerald-200/70">Estimated ${dominant[0]} next week: ~${weeklyEstimate.toFixed(1)}</div></div>`;
    }

    // form submit
    form.addEventListener('submit', e => {
      e.preventDefault();
      const t = wasteType.value; const q = parseFloat(wasteQty.value)||1;
      const entry = { type: t, qty: q, date: new Date().toLocaleDateString(), label: '' };
      data.push(entry); localStorage.setItem('ecosnap_tracker', JSON.stringify(data)); wasteQty.value = ''; renderHistory(); renderChart(); analyze();
    });

    exportBtn.addEventListener('click', ()=> {
      const csv = ['type,qty,date,label', ...data.map(d=>`${d.type},${d.qty},${d.date},"${(d.label||'').replace(/"/g,'""')}"`)].join('\n');
      const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='ecosnap_tracker.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    clearBtn.addEventListener('click', ()=> { if(confirm('Clear all tracker data?')){ data=[]; localStorage.removeItem('ecosnap_tracker'); renderHistory(); renderChart(); analyze(); }});
    addSample.addEventListener('click', ()=> {
      const sample = [
        {type:'Plastic',qty:3,date:new Date().toLocaleDateString()},
        {type:'Paper',qty:1,date:new Date().toLocaleDateString()},
        {type:'Organic',qty:2,date:new Date().toLocaleDateString()},
        {type:'Plastic',qty:1,date:new Date().toLocaleDateString()}
      ];
      data = data.concat(sample); localStorage.setItem('ecosnap_tracker', JSON.stringify(data)); renderHistory(); renderChart(); analyze();
    });

    // init
    renderHistory(); renderChart(); analyze();
  </script>
</body>
</html>
